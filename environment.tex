\section{Environment}\label{sec:environment}

\subsection{What are the properties of the environment?}
The properties of the environment are derived directly from the modules that comprise it.  Properties belong to one of two types: infrastructure or operations.

\subsubsection{Infrastructure}
The \texttt{GridTransitionMap} and \texttt{Agent} classes simulate the physical infrastructure of a true environment, and their attributes are accessible through the environment.  For example, calling \texttt{env.rail.grid} returns a matrix of ID values, representing the track type for each cell.  Calling \texttt{env.agents[0]} returns an overview much like what is shown below:

\begin{table}[H]
\centering
	{\footnotesize
  	\begin{tabular}{@{\hspace*{1em}}ll@{}}
    	\toprule
	\texttt{handle(agent index): 0} \\
		\texttt{target: (13, 19)}  \\
		\texttt{initial\_position: (24, 13)} & 	\texttt{initial\_direction: 0}  \\
		\texttt{earliest\_departure: 2}  &	\texttt{latest\_arrival: 31}  \\[.25\normalbaselineskip]
		
		\texttt{old\_position: None} 	&	\texttt{old\_direction: None}  \\
		\texttt{position: None}  	&	\texttt{direction: 0}   \\
		\texttt{state: TrainState.WAITING} &	\texttt{in\_malfunction: False}    \\             
		\texttt{speed: 1.0}       \\     
	\bottomrule

  	\end{tabular}
	}
\end{table} 

\noindent Each of these attributes is accessible for any agent at any time.



\subsubsection{Operations}
The schedules, paths, and delays represet the operations of an environment.  \textit{Under construction: more information to come}



%The Flatland environment has three primary responsibilities:
%\begin{itemize}
%	\item Gathering the primary underlying modules in a single location
%	\item Providing the ability to perform a discrete-time simulation
%	\item Rendering the output of a simulation
%\end{itemize}

%\subsubsection{Underlying modules}
%By gathering the underlying modules, Flatland can virtually represent the key components of a railway network.  In particular, there are infrastucture components and operation components.

%\begin{table}[H]
%\begin{tabular}{@{}ll@{}}
%\toprule
%Infrastructure    & Operations               \\ \midrule
%tracks and trains & schedules, paths, delays \\ \bottomrule
%\end{tabular}
%\end{table}

%\textbf{Infrastucture components} include the tracks and the trains.  These are supported by the \textit{Grid Transition Map}, the \textit{Rail Generator}, and the \textit{Agent}.
%\textbf{Operation components} include the schedules, paths, and delays.  These are supported by the \textit{Timetable Generator}, the \textit{Line Generator}, and the %\textit{Malfunction Builder}.

\subsection{What does the environment require for a solution?}
Interaction with the environment is done via the \texttt{step()} function.  Flatland is a discrete time simulation, and each call of this function increments the simulation by a single time step.  The function takes as input a Python dictionary, \texttt{action\_dict}, whose keys correspond to the handles of the agents in the environment and whose values correspond to the action assigned to each agent at the current time step.  This means the size of the dictionary is the same as the number of agents in the environment.  Below is an example for an environment with two agents:

\begin{verbatim}
{0: RailEnvActions.MOVE_FORWARD, 1: RailEnvActions.MOVE_RIGHT}
\end{verbatim}

\noindent Ultimately, a solution is reached so long as all agents reach their respective targets within the assigned timeframes and without incurring a collision.  Since only one action per agent is given at each time step, the function must be called repeatedly until a solution has been reached.  This quality allows for flexibility throughout the simulation, particularly to handle unexpected malfunctions; if entire agent paths were required from the start, this would not be the case.  Each time the function is called, the environment updates, which includes advancing agent states, locations, and directions. As output, the function provides a current look at the environment through four objects: observations, rewards, done status, and additional information.

\subsection{What is the output of the environment?}
The primary output of the simulation is a rendered animation of the trains traversing the environment.  The \texttt{render\_env()} function is called immediately prior to each \texttt{step()} function call to capture a snapshot of the environment at that time step.  Additionally, once the entire simulation has completed, there is a \texttt{RailEnvPersister} class which allows the episode to be saved into a separate file to be loaded later.  Optionally, as part of this output file, a distance map can be saved \textit{(explanation about what this is)}.


%There are three ? when considering the output of the environment:
%\begin{enumerate}
%	\item Intended output
%	\item Intermedieate output
%	\item Accessible attributes
%\end{enumerate}


